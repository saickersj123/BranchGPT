<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT 서비스</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@^6.26.0/babel.min.js"></script>
    <script>
        // 전역 변수로 로그인 상태를 정의
        var isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    </script>
</head>
<body>
<header class="header">
    <div class="header-center">
        <a href="index.html">react-bootstrap을 쓸 공간</a>
    </div>
    <div class="auth-button" id="authButtonContainer"></div> <!-- 로그인 버튼 -->
</header>

<main class="main-section">
    <script>
        // 조건에 따라 HTML을 동적으로 생성
        if (isLoggedIn) {
            document.write('<div class="ChatList">MongoDB에서 대화기록을 가지고 올 공간</div>');
            document.write('<div class="chat-container">');
            document.write('<div class="chat-container" id="chatApp"></div>');
            document.write('</div>');
        } else {
            document.write('<div class="login-message">서비스 이용을 위해선 로그인이 필요합니다.</div>');
        }
    </script>
</main>

<footer class="footer">
    <p>&copy; GPT 서비스.</p>
    <nav>
        <a href="#">이용 약관</a>
        <a href="#">연락처</a>
    </nav>
</footer>

<script type="text/babel">
    const { useState } = React;

    const ChatBox = ({ sendMessage }) => {
        const [message, setMessage] = useState('');

        const handleMessageChange = (event) => {
            setMessage(event.target.value);
        };

        const sendMessageToChatList = () => {
            if (message.trim() === '') return;
            sendMessage(message);
            setMessage('');
            console.log('메시지 전송:', message);
        };

        const handleKeyPress = (event) => {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessageToChatList();
            }
        };

        return (
            <div className="chat-input-container">
                <textarea
                    value={message}
                    onChange={handleMessageChange}
                    onKeyPress={handleKeyPress}
                    placeholder="메시지를 입력하세요..."
                    className="chat-container"
                />
                <button onClick={sendMessageToChatList} className="chat-box-button">전송</button>
            </div>
        );
    };

    const rootElement = document.getElementById("chatApp");
    ReactDOM.render(<ChatBox sendMessage={() => {}} />, rootElement);
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const authButtonContainer = document.getElementById("authButtonContainer");

        const authButton = document.createElement('p');
        authButton.classList.add('auth-button');
        authButton.addEventListener('click', function() {
            if (isLoggedIn) {
                localStorage.removeItem('isLoggedIn');
                isLoggedIn = false; // 전역 변수 업데이트
                window.location.reload();
            } else {
                window.location.href = "login.html";
            }
        });

        if (isLoggedIn) {
            authButton.innerText = "로그아웃";
            
            // 마이페이지 버튼 추가
            const myPageButton = document.createElement('p');
            myPageButton.classList.add('auth-button');
            myPageButton.innerText = "마이페이지";
            myPageButton.addEventListener('click', function() {
                window.location.href = "mypage.html";
            });

            const buttonContainer = document.createElement('div');
            buttonContainer.style.display = 'flex';
            buttonContainer.style.gap = '10px';
            
            buttonContainer.appendChild(authButton);
            buttonContainer.appendChild(myPageButton);
            
            authButtonContainer.appendChild(buttonContainer);
        } else {
            authButton.innerText = "로그인";
            authButtonContainer.appendChild(authButton);
        }
    });
</script>

</body>
</html>